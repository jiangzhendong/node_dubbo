<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.haier.openplatform.showcase.apportion.dao.CompanyPlatformDAO">
	<!-- oracle 分页头 -->
	<!--<sql id="pagination_Head" >-->
		<!--<![CDATA[select * from ( select row_.*, rownum rownum_ from ( ]]>-->
	<!--</sql>-->
	 <!--&lt;!&ndash; oracle 分页尾 &ndash;&gt;-->
	<!--<sql id="pagination_Tail">-->
	  <!--<![CDATA[) row_ where rownum <= #{pageSize}* #{currentPage} ) where rownum_ >= #{firstResult} + 1]]>-->
	<!--</sql>-->
	<!--&lt;!&ndash; count * from &ndash;&gt;-->
	<!--<sql id="count_Start_Head">-->
		<!--<![CDATA[select count(*) from ( ]]>-->
	<!--</sql>-->
	<!--<sql id="count_Start_Tail">-->
		<!--<![CDATA[)]]>-->
	<!--</sql>-->
	 <!--mysql 分页头 -->
	<sql id="pagination_Head" >
		<![CDATA[]]>
	</sql>
	 <!--mysql 分页尾 -->
	<sql id="pagination_Tail">
		<![CDATA[limit #{pager.firstResult}, #{pager.pageSize}]]>
	</sql>


	<resultMap id="companyPlatformMap" type="companyPlatform">
		<id property="id" column="ID" javaType="long" jdbcType="NUMERIC" />
		<result property="companyCode" column="company_code"/>
		<result property="companyName" column="company_name"/>
		<result property="platformCode" column="platform_code"/>
		<result property="platformName" column="platform_name"/>
		<result property="mainBusinessIncome" column="main_business_income"/>
		<result property="asset" column="asset"/>
		<result property="employeeCount" column="employee_count"/>
		<result property="salary" column="salary"/>
		<result property="salesCount" column="sales_count"/>
		<result property="years" column="years"/>
		<result property="months" column="months"/>
		<result property="version" column="version"/>
		<result property="gmtCreate" column="gmt_create"/>
	</resultMap>
	
	<!-- 查询公司原始数据列表 -->
	<select id="getList" resultMap="companyPlatformMap" parameterType="companyPlatform">
		<include refid="pagination_Head"/>
		select compla.*,com.company_name,
			   com.main_business_income,
			   com.sales_count,com.employee_count,
			   com.salary,com.asset,
			   pla.platform_name
		from FT_COMPANY_PLATFORM compla, FT_COMPANY_DATA com, FT_PLATFORM_FILE pla
			where compla.platform_code = pla.platform_code
				  and compla.company_code = com.company_code
				  and compla.version = #{version}
				  and com.years = #{years}
				  and com.months = #{months}
				  order by compla.platform_code , compla.id
		<include refid="pagination_Tail"/>
	</select>
	
	<select id="findByCompanyPlatform" resultMap="companyPlatformMap">
		select compla.*, com.*, pla.platform_name
		from FT_COMPANY_PLATFORM compla, FT_COMPANY_DATA com, FT_PLATFORM_FILE pla
			where compla.platform_code = pla.platform_code
				  and compla.company_code = com.company_code
				  and compla.version = #{version}
				  and com.years = #{years}
				  and com.months = #{months}
				  and compla.platform_code = #{platformCode}
	</select>
	<select id="getCount" resultType="long">
    	<include refid="count_Start_Head"/>
    	select compla.*
		from FT_COMPANY_PLATFORM compla, FT_COMPANY_DATA com, FT_PLATFORM_FILE pla
			where compla.platform_code = pla.platform_code
				  and compla.company_code = com.company_code
				  and compla.version = #{version}
				  and com.years = #{years}
				  and com.months = #{months}
        <include refid="count_Start_Tail"/>
    </select >
</mapper>